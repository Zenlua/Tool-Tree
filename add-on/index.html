<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Manager</title>
<style>
body { font-family: monospace; background: #0d1117; color: #c9d1d9; margin: 0; padding: 12px; }
h3 { color: #58a6ff; font-size: 20px; margin-bottom: 6px; }
button { margin-right: 6px; padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 24px; line-height: 1; }
button.home { background: #238636; color: white; }
button.back { background: #1f6feb; color: white; }
#pathContainer { display: flex; align-items: center; flex-wrap: wrap; background: #010409; border: 1px solid #30363d; border-radius: 6px; padding: 6px 10px; margin-bottom: 10px; }
#currentPath { color: #79c0ff; font-weight: bold; font-size: 16px; word-break: break-all; flex: 1; }
pre { margin: 0; padding: 10px; background: #010409; border: 1px solid #30363d; border-radius: 6px; flex: 1; overflow-y: auto; white-space: pre-wrap; word-break: break-word; }
.file-item { cursor: pointer; font-size: 18px; padding: 4px 6px; border-bottom: 1px solid #30363d; }
.file-item:hover { background: #161b22; }
/* Modal */
#modalOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:1000; }
#modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#010409; color:#c9d1d9; border:1px solid #30363d; border-radius:6px; padding:12px; z-index:1001; max-width:90%; width:400px; }
#fileInfo { background:#0d1117; padding:10px; border:1px solid #30363d; border-radius:4px; white-space: pre-wrap; max-height:300px; overflow-y:auto; margin-bottom:10px; font-size:14px; }
#modal button { font-size:16px; padding:4px 8px; margin-right:4px; }
</style>
</head>
<body>

<h3>File Manager</h3>

<div id="pathContainer">
    <button class="home" onclick="goHome()">üè†</button>
    <button class="back" onclick="goBack()">üëà</button>
    <span id="currentPath"></span>
</div>

<pre id="fileList"></pre>

<!-- Modal -->
<div id="modalOverlay"></div>
<div id="modal">
    <h4 id="modalFileName"></h4>
    <pre id="fileInfo"></pre>
    <button onclick="viewText()">Text</button>
    <button onclick="renameFile()">Rename</button>
    <button onclick="deleteFile()">Delete</button>
    <button onclick="closeModal()">Close</button>
</div>

<script>
var output = document.getElementById("fileList");
var pathDisplay = document.getElementById("currentPath");
var modalOverlay = document.getElementById("modalOverlay");
var modal = document.getElementById("modal");
var modalFileName = document.getElementById("modalFileName");
var fileInfo = document.getElementById("fileInfo");

var HOME = KrScriptCore.executeShell('pwd').trim();
var currentPath = HOME;
var selectedFile = null;

function shellEscape(str){ return str.replace(/(["$`\\])/g,'\\$1'); }

// Li·ªát k√™ file/folder
function listFiles(){
    pathDisplay.textContent = currentPath;
    try{
        var cmd = 'ls -1ALF "'+shellEscape(currentPath)+'" | sort -f';
        var result = KrScriptCore.executeShell(cmd);
        if(result){
            var lines = result.split('\n').filter(l=>l.trim()!=='');
            output.innerHTML = lines.map(l=>{
                var icon='üìÑ', isDir='0';
                if(l.endsWith('/')){ icon='üìÅ'; isDir='1'; l=l.slice(0,-1); }
                else if(l.endsWith('@')){ icon='üîó'; isDir='0'; l=l.slice(0,-1); }
                else if(l.endsWith('*')){ icon='üìÑ'; isDir='0'; l=l.slice(0,-1); }
                return '<div class="file-item" data-name="'+l+'" data-dir="'+isDir+'">'+icon+' '+l+'</div>';
            }).join('');
        } else { output.textContent='(Empty folder)'; }
    }catch(e){ output.textContent='Error: '+e; }
}

// V√†o folder
function enterFolder(folder){
    currentPath = currentPath + '/' + folder;
    listFiles();
}

// Back
function goBack(){
    if(currentPath==='/' ) return;
    var parent = KrScriptCore.executeShell('dirname "'+shellEscape(currentPath)+'"').trim();
    if(parent){ currentPath = parent; }
    listFiles();
}

// Home
function goHome(){ currentPath=HOME; listFiles(); }

// Modal
function openModal(file){
    selectedFile = file;
    modalFileName.textContent = file;
    try{
        var info = KrScriptCore.executeShell('ls -lhZ "'+shellEscape(currentPath+'/'+file)+'" 2>/dev/null');
        fileInfo.textContent = info;
    }catch(e){ fileInfo.textContent='Cannot read info'; }
    modalOverlay.style.display='block';
    modal.style.display='block';
}
function closeModal(){ modalOverlay.style.display='none'; modal.style.display='none'; selectedFile=null; }
function viewText(){
    if(!selectedFile) return;
    try{
        var content = KrScriptCore.executeShell('cat "'+shellEscape(currentPath+'/'+selectedFile)+'" 2>/dev/null');
        fileInfo.textContent = content || '(Empty file)';
    }catch(e){ fileInfo.textContent='Cannot read file'; }
}
function renameFile(){ alert('Rename '+selectedFile); }
function deleteFile(){ alert('Delete '+selectedFile); }

// Click v√†o file/folder
output.addEventListener('click',function(e){
    var target = e.target.closest('.file-item');
    if(!target) return;
    var name = target.dataset.name;
    var isDir = target.dataset.dir;
    if(isDir==='1'){ enterFolder(name); }
    else { openModal(name); }
});

listFiles();
</script>

</body>
</html>