#!/data/data/com.tool.tree/files/home/bin/bash
# Kakathic

IFS=$'\n'
[ -e "$2" ] && cd "$2" || exit 1

case "$1" in
  0)
    for vv in $(ls -1d *); do
      [[ "$vv" == *config* || "$vv" == *raw* || ! -e "config/${vv}_info" ]] && continue
      info=$(head -n1 "config/${vv}_info")
      [[ -z "$info" ]] && continue
      echo "$vv|$vv ($info)"
    done
    ;;

  1)
    for vv in $(ls -1d *.*); do
      # *.img *.dat *.zstd *.zst *.br
      [[ -s "$vv" && -f "$vv" ]] || continue
      type=$(checktype "$vv")
      echo "$vv|$vv ($type)"
      # | grep -E '\(super\)|\(ext\)|\(f2fs\)|\(sparse\)|\(erofs\)|\(dat\)|\(zstd\)|\(br\)'
    done
    ;;

  2)
    for vv in $(ls -1d *.*); do
      # *.img *.zstd *.zst *.br *.dat *.bin *.zip
      [[ -s "$vv" && -f "$vv" ]] || continue
      type=$(checktype "$vv")
      case "$type" in
        payload)
          listpayload "$vv" | awk -v f="$vv" '{print $1"="f"|Payload - "$1" "$2}'
          ;;
        super)
          listsuper "$vv" | awk -v f="$vv" '{print $1"="f"|Super - "$1" "$2}'
          ;;
        zip)
          [ -n "$(listpayload "$vv")" ] && listpayload "$vv" | awk -v f="$vv" '{print $1"="f"|Payload - "$1" "$2}' && continue
          Listzipne="$(unzip -ql "$vv" 2>/dev/null | awk '/\.(img|dat|br|zstd|zst|gz|xz|lz4|lzma)$/{cmd="coverbyte "$1;cmd|getline s;close(cmd);n=$4;o=n;if(index(n,"/")){sub(/^.*\//,"",n);n=".../"n} if(s!="0B")printf "%s=%s|Zip - %s (%s)\n",o,"'"$vv"'",n,s}')"
          [ -n "$Listzipne" ] && echo "$Listzipne"
          ;;
        *)
          echo "$vv|$vv ($type)"
          # | grep -E '\(squashfs\)|\(amlogic\)|\(ext\)|\(f2fs\)|\(sparse\)|\(erofs\)|\(dat\)|\(zstd\)|\(zst\)|\(dtbo\)|\(super\)|\(br\)|\(boot\)|\(logo\)|\(vendor_boot\)|\(vbmeta(_system)?\)'
          ;;
      esac
    done
    ;;

  3)
    for vv in $(ls -1d *.img); do
      [[ "$vv" == *super* ]] && continue
      [[ -s "$vv" && -f "$vv" ]] || continue
      type=$(checktype "$vv")
      echo "$vv|$vv ($type)" | grep -E '\(ext\)|\(f2fs\)|\(sparse\)|\(erofs\)|\(unknown\)'
    done
    ;;

  4)
    for vv in $(ls -1d *); do
      [[ -d "$vv" && $(ls "$vv" 2>/dev/null) ]] || continue
      size=$(du -sm "$vv" | awk '{print $1}')
      echo "$vv|$vv (${size}Mb)"
    done
    ;;

  5)
    for vv in $(ls -1d super.img.*); do
      [[ -e "$vv" ]] && echo "$2/$vv|$vv"
    done
    ;;

  6)
    for vv in $(ls -1d system*.img); do
      [[ "$vv" == *system_ext* ]] && continue
      [[ -s "$vv" && -f "$vv" ]] || continue
      type=$(checktype "$vv")
      echo "$vv|$vv ($type)" | grep -E '\(ext\)|\(f2fs\)|\(sparse\)|\(erofs\)'
    done
    ;;

  7)
    for vv in $(ls -1d super*.img); do
      [[ -s "$vv" && -f "$vv" ]] || continue
      type=$(checktype "$vv")
      echo "$vv|$vv ($type)" | grep -E '\(super\)|\(sparse\)'
    done
    ;;

  8)
    for vv in $(ls -1d *.img); do
      [[ -s "$vv" && -f "$vv" ]] || continue
      type=$(checktype "$vv")
      echo "$vv|$vv ($type)" | grep -v -E '\(sparse\)|\(super\)'
    done
    ;;

  9)
    for vv in $(ls -1d *.apk *.zip *.jar *.apks *.apkm *.xapk); do
      [[ -s "$vv" && -f "$vv" ]] || continue
      info=$(checkapk "$vv")
      echo "$vv|$vv ($info)" | grep -v -E '\(unknown\)|\(class\)|\(zip\)'
    done
    ;;

  10)
    for vv in $(ls -1d *.apk *.zip); do
      [[ -s "$vv" && -f "$vv" ]] || continue
      info=$(checkapk "$vv")
      echo "$vv|$vv ($info)" | grep "\(apk\)"
    done
    ;;

  11)
    for vv in $(ls -1d *.img); do
      [[ "$vv" == *super* ]] && continue
      [[ -s "$vv" && -f "$vv" ]] || continue
      type=$(checktype "$vv")
      echo "$vv|$vv ($type)"
    done
    ;;

  12)
    for vv in $(ls -1d *.apex *.capex); do
      [[ -s "$vv" && -f "$vv" ]] || continue
      info=$(checkapk "$vv")
      echo "$vv|$vv ($info)" | grep -E '\(capex\)|\(apex\)'
    done
    ;;

  folders)
    for d in $(ls -1d */); do
      d="${d%/}"
      echo "$2/$d|${2##*/}/$d"
    done
    ;;

  folder)
    for d in $(ls -1d */); do
      echo "$2/${d%/}"
    done
    ;;

  for)
    for d in $(ls -1d */); do
      echo "${d%/}"
    done
    ;;

  forapk)
    ls -1d */archive-info.json | sed 's|/archive-info.json||g'
    ;;

  forapkt)
    ls -1d */apktool.yml | sed 's|/apktool.yml||g'
    ;;

  forapex)
    ls -1d */apex_infor.ini | sed 's|/apex_infor.ini||g'
    ;;

  file)
    for f in $(ls -1d $3); do
      [[ -s "$f" && -f "$f" ]] || continue
      echo "$f"
    done
    ;;

  files)
    for f in $(ls -1d $3); do
      [[ -s "$f" && -f "$f" ]] || continue
      info=$(checkapk "$f")
      echo "$f|$f ($info)"
    done
    ;;

  *)
    for vv in $1; do
      find . -maxdepth 1 -type f -name "*.$vv" -printf '%f\n'
    done
    ;;
esac
